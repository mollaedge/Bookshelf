<div class="dashboard">
  <div class="dashboard-header">
    <p class="subtitle" *ngIf="!userDashboard">Welcome back, let's explore your activity</p>
    <p class="subtitle" *ngIf="userDashboard">Welcome back, {{ userDashboard.fullName }} â€” here's your activity</p>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-book"></i>
      </div>
      <div class="stat-info">
        <h3>Books Owned</h3>
        <p class="stat-number" *ngIf="!dashboardLoading">{{ userDashboard?.stats?.booksOwned ?? '-' }}</p>
        <p class="stat-number loading-placeholder" *ngIf="dashboardLoading">...</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-bookmark"></i>
      </div>
      <div class="stat-info">
        <h3>Borrowed</h3>
        <p class="stat-number" *ngIf="!dashboardLoading">{{ userDashboard?.stats?.currentlyBorrowed ?? '-' }}</p>
        <p class="stat-number loading-placeholder" *ngIf="dashboardLoading">...</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-info">
        <h3>Books Read</h3>
        <p class="stat-number" *ngIf="!dashboardLoading">{{ userDashboard?.stats?.booksRead ?? '-' }}</p>
        <p class="stat-number loading-placeholder" *ngIf="dashboardLoading">...</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-clock"></i>
      </div>
      <div class="stat-info">
        <h3>Pending Requests</h3>
        <p class="stat-number" *ngIf="!dashboardLoading">{{ userDashboard?.stats?.pendingRequests ?? '-' }}</p>
        <p class="stat-number loading-placeholder" *ngIf="dashboardLoading">...</p>
      </div>
    </div>
  </div>

  <div class="content-grid">
    <div class="content-card large">
      <h2>Reading Progress</h2>
      <div class="card-content">

        <div class="progress-placeholder" *ngIf="!isLoggedIn">
          <i class="fas fa-book-open"></i>
          <p>Sign in to see your reading progress</p>
        </div>

        <div class="progress-loading" *ngIf="isLoggedIn && dashboardLoading">
          <p>Loading...</p>
        </div>

        <div class="progress-breakdown" *ngIf="userDashboard && !dashboardLoading">
          <p class="progress-summary">
            You've read <strong>{{ userDashboard.stats.booksRead }}</strong> books
            across a library of <strong>{{ userDashboard.stats.booksOwned }}</strong>
          </p>

          <div class="progress-row">
            <div class="progress-label">
              <span class="label-name">Books Owned</span>
              <span class="label-value">{{ userDashboard.stats.booksOwned }}</span>
            </div>
            <div class="progress-track">
              <div class="progress-fill owned"
                [style.width.%]="readBarWidth(userDashboard.stats.booksOwned)"></div>
            </div>
          </div>

          <div class="progress-row">
            <div class="progress-label">
              <span class="label-name">Books Read</span>
              <span class="label-value">{{ userDashboard.stats.booksRead }}</span>
            </div>
            <div class="progress-track">
              <div class="progress-fill read"
                [style.width.%]="readBarWidth(userDashboard.stats.booksRead)"></div>
            </div>
          </div>

          <div class="progress-row">
            <div class="progress-label">
              <span class="label-name">Currently Borrowed</span>
              <span class="label-value">{{ userDashboard.stats.currentlyBorrowed }}</span>
            </div>
            <div class="progress-track">
              <div class="progress-fill borrowed"
                [style.width.%]="readBarWidth(userDashboard.stats.currentlyBorrowed)"></div>
            </div>
          </div>

          <div class="progress-legend">
            <span class="legend-dot owned"></span><span>Owned</span>
            <span class="legend-dot read"></span><span>Read</span>
            <span class="legend-dot borrowed"></span><span>Borrowed</span>
          </div>
        </div>

      </div>
    </div>
    
    <div class="content-card">
      <div class="card-header-row">
        <h2>Recently Added</h2>
        <a routerLink="/mybooks" class="card-link">View all</a>
      </div>

      <div class="recent-loading" *ngIf="recentBooksLoading">
        <div class="skeleton-item" *ngFor="let i of [1,2,3]"></div>
      </div>

      <div class="recent-empty" *ngIf="!recentBooksLoading && !isLoggedIn">
        <p>Sign in to see your library</p>
      </div>

      <div class="recent-empty" *ngIf="!recentBooksLoading && isLoggedIn && recentBooks.length === 0">
        <p>No books in your library yet</p>
      </div>

      <div class="book-list" *ngIf="!recentBooksLoading && recentBooks.length > 0">
        <div class="book-item" *ngFor="let book of recentBooks">
          <div class="recent-book-cover">
            <img *ngIf="book.cover" [src]="'data:image/jpeg;base64,' + book.cover" [alt]="book.title">
            <img *ngIf="!book.cover && book.coverUrl" [src]="book.coverUrl" [alt]="book.title">
            <div *ngIf="!book.cover && !book.coverUrl" class="recent-book-emoji">ðŸ“š</div>
          </div>
          <div class="book-info">
            <h4>{{ book.title }}</h4>
            <p class="book-author">{{ book.authorName }}</p>
            <span class="genre-badge" *ngIf="book.genre">{{ book.genre }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="content-card">
      <h2>Reading Goals</h2>
      <div class="goals-list">
        <div class="goal-item">
          <div class="goal-progress">75%</div>
          <div class="goal-info">
            <h4>Monthly Goal</h4>
            <p>3 of 4 books read</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="book-sections">
    <div class="section-header">
      <h2>Recommended for you</h2>
      <span class="book-count">{{ recommendedBooks.length }} books</span>
    </div>
    
    <div class="loading" *ngIf="loading">
      <p>Loading books...</p>
    </div>
    
    <div class="error" *ngIf="error">
      <p>{{ error }}</p>
    </div>
    
    <div class="books-table-container" *ngIf="!loading && !error && recommendedBooks.length">
      <table class="books-table">
        <thead>
          <tr>
            <th>Cover</th>
            <th>Title</th>
            <th>Author</th>
            <th>Genre</th>
            <th>ISBN</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let book of recommendedBooks">
            <td>
              <div class="table-book-cover">
                <img *ngIf="book.cover" [src]="'data:image/jpeg;base64,' + book.cover" [alt]="book.title">
                <img *ngIf="!book.cover && book.coverUrl" [src]="book.coverUrl" [alt]="book.title">
                <div *ngIf="!book.cover && !book.coverUrl" class="table-book-emoji">ðŸ“š</div>
              </div>
            </td>
            <td>
              <div class="book-title-cell">
                <strong>{{ book.title }}</strong>
              </div>
            </td>
            <td>{{ book.authorName }}</td>
            <td>
              <span class="genre-badge" *ngIf="book.genre">{{ book.genre }}</span>
              <span class="no-genre" *ngIf="!book.genre">-</span>
            </td>
            <td>
              <span class="isbn-text" *ngIf="book.isbn">{{ book.isbn }}</span>
              <span class="no-isbn" *ngIf="!book.isbn">-</span>
            </td>
            <td>
              <button class="btn-request" (click)="requestBook(book.id)">Request</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="empty-state" *ngIf="!loading && !error && !recommendedBooks.length">
      <p>No books available.</p>
    </div>

    <div class="section-header">
      <h2>Categories</h2>
      <a href="#" class="view-all">View all</a>
    </div>

    <div class="categories-grid">
      <div class="category-card fiction">
        <i class="fas fa-book"></i>
        <h3>Fiction</h3>
        <p>1.2k books</p>
      </div>
      <div class="category-card science">
        <i class="fas fa-flask"></i>
        <h3>Science</h3>
        <p>850 books</p>
      </div>
      <div class="category-card history">
        <i class="fas fa-landmark"></i>
        <h3>History</h3>
        <p>642 books</p>
      </div>
      <div class="category-card biography">
        <i class="fas fa-user-tie"></i>
        <h3>Biography</h3>
        <p>428 books</p>
      </div>
    </div>
  </div>
</div>
